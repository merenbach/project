{% extends "base.html" %}
{% load sekizai_tags compress dajaxice_templatetags static %}
{% load url from future %}

{% block title %}Ciphers{% endblock %}
{% block subtitle %} <small>Alpha</small>{% endblock %}

{% block extra_js %}
{{ block.super }}

{% compress js %}
{% dajaxice_js_import %}
<script type="text/javascript" charset="utf-8" src="{% static "dajax/jquery.dajax.core.js" %}"></script>
<script type="text/javascript">
    
    (function($) {
        var $field_source     = $('.field-source');
        var $field_target     = $('.field-target');
        var $field_lowercase  = $('.field-lowercase');
        var $field_filter     = $('.field-filter');
        var $field_chunk      = $('.field-chunk');
        var $field_target     = $('.field-target');
        var $field_multiplier = $('.field-multiplier');
        var $field_additive   = $('.field-additive');
        var $field_shift      = $('.field-shift');
        var $field_keyword    = $('.field-keyword');
        var $field_passphrase = $('.field-passphrase');
        var $field_primer     = $('.field-primer');
        var $field_digits     = $('.field-digits');
        // var $radio_operation  = $('input:radio[name=operation]:checked');
        var $radio_autoclave  = $('input:radio[name=autoclave]');

        function transcode_message($pane, transcode_callback) {
        	var message = $pane.find($field_source).val();
            if (typeof(message) === 'string' && message !== '') {
                var message_args = {};
                message_args.message = message;
            	message_args.should_filter = $pane.find($field_filter).is(':checked') ? true : false;
            	message_args.lower = $pane.find($field_lowercase).is(':checked') ? true : false;
            	message_args.chunk = parseInt($pane.find($field_chunk).val());
                
                try {
                     message_args.multiplier = $pane.find($field_multiplier).val();
                } finally {}
                
                try {
                    message_args.additive = $pane.find($field_additive).val();
                } finally {}
                
                try {
                	message_args.shift = $pane.find($field_shift).val();
                } finally {}
                
                try {
                	message_args.keyword = $pane.find($field_keyword).val();
                } finally {}
                
                try {
                    message_args.passphrase = $pane.find($field_passphrase).val();
                } finally{}
                
                try {
                    message_args.primer = $pane.find($field_primer).val();
                } finally{}
                
                try {
                    var $field = $pane.find($field_digits);
                    if ($field.length) {
                        message_args.use_digits = $field.is(':checked') ? true : false;
                    }
                } finally{}
                
                // try {
                //     var $field = $pane.find($radio_operation);
                //     if ($field.length) {
                //         message_args.operation = ($field.val() === 'encode') ? true : false;
                //     }
                // } finally{}
                
                try {
                    var $field = $pane.find($radio_autoclave).filter(':checked');
                    if ($field.length) {
                        message_args.autoclave = ($field.val() === 'text') ? true : false;
                    }
                } finally{}

        		$pane.find($field_target).val('');
                // $pane.find($field_target).val('Processing...');
        		transcode_callback(Dajax.process, message_args);
            }
        }

        function encode_affine() {
            var $pane = $('#affine_pane');
            transcode_message($pane, Dajaxice.ciphers.encode_affine);
        }
        
        function decode_affine() {
            var $pane = $('#affine_pane');
            transcode_message($pane, Dajaxice.ciphers.decode_affine);
        }

        function transcode_atbash() {
            var $pane = $('#atbash_pane');
            transcode_message($pane, Dajaxice.ciphers.transcode_atbash);
        }

        function transcode_beaufort() {
            var $pane = $('#beaufort_pane');
            transcode_message($pane, Dajaxice.ciphers.transcode_beaufort);
        }

        function encode_caesar() {
            var $pane = $('#caesar_pane');
            transcode_message($pane, Dajaxice.ciphers.encode_caesar);
        }
        
        function decode_caesar() {
            var $pane = $('#caesar_pane');
            transcode_message($pane, Dajaxice.ciphers.decode_caesar);
        }

        function encode_codeword() {
            var $pane = $('#codeword_pane');
            transcode_message($pane, Dajaxice.ciphers.encode_codeword);
        }
        
        function decode_codeword() {
            var $pane = $('#codeword_pane');
            transcode_message($pane, Dajaxice.ciphers.decode_codeword);
        }

        function encode_vigenere() {
        	var $pane = $('#vigenere_pane');
            transcode_message($pane, Dajaxice.ciphers.encode_vigenere);
        }

        function decode_vigenere() {
        	var $pane = $('#vigenere_pane');
            transcode_message($pane, Dajaxice.ciphers.decode_vigenere);
        }

        $(document).ready(function() {
            $('.pane').hide();

            $('#scheme').change(function() {
            	el_id = $(this).val();
            	$('.pane').hide();
            	$('#' + el_id + '_pane').show();
            });

        	$('#affine_pane .button-encode').click(encode_affine);
        	$('#affine_pane .button-decode').click(decode_affine);
        	$('#atbash_pane .button-transcode').click(transcode_atbash);
        	$('#caesar_pane .button-encode').click(encode_caesar);
        	$('#caesar_pane .button-decode').click(decode_caesar);
        	$('#beaufort_pane .button-transcode').click(transcode_beaufort);
        	$('#codeword_pane .button-encode').click(encode_codeword);
        	$('#codeword_pane .button-decode').click(decode_codeword);
        	$('#vigenere_pane .button-encode').click(encode_vigenere);
        	$('#vigenere_pane .button-decode').click(decode_vigenere);

        	$('#intro_pane').show();
        	window.onbeforeunload = function() {};
        });
    })(jQuery);

</script>
{% endcompress %}
{% endblock %}

{% block content %}
{{ block.super }}

<article>
	<p>This page represents an ever-evolving (and ever-incomplete) attempt at making a multifunctional text encryption and decryption tool.  There are plenty like this (and better than this) elsewhere on the Internet, so if you seek style and flair, you might wish to reconsider before directing others to this specific page.</p>

	<p>That said, this particular encryption tool differs from many others in one important respect: it uses AJAX to perform the encryption and decryption server-side.  This isn't "safer" by any stretch (quite the opposite, perhaps), but it lets me make the code (written in Python, server-side) more maintainable without changing much in terms of browser integration.</p>

	<form class="form-horizontal" method="GET" action="{% url 'ciphers' %}">{% csrf_token %}
		<noscript>
			<p>This application requires JavaScript.  Please enable JavaScript in your browser preferences to proceed.</p>
		</noscript>
		<section>
			<fieldset style="margin-bottom: 10px;">
				<div class="control-group">
					<label class="control-label" for="scheme">Cipher Scheme</label>
					<div class="controls">
						<select id="scheme">
							<option value="intro">Introduction</option>
							<option value="affine">Affine</option>
							<option value="atbash">Atbash</option>
							<option value="beaufort">Beaufort</option>
							<!--<option value="beaufortautokey">Beaufort Autoclave (custom)</option>-->
							<option value="caesar">Caesar</option>
							<option value="codeword">Codeword</option>
							<!--<option value="gronsfeld">x Gronsfeld</option>-->
							<!--<option value="variant">x Variant Beaufort</option>-->
							<option value="vigenere">Vigen&#232;re</option>
						</select>
						<span class="help-inline">The cipher scheme to use</span>
					</div>
				</div>
			</fieldset>
		</section>
		<section class="pane" id="intro_pane">
			<p>
				Welcome to Andrew Merenbach's cipher tool suite.  Encryption schemes provided include affine, Atbash, Beaufort, Caesar shift, codeword, <!--variant Beaufort (including an autoclave version),-->and Vigen&#232;re (including an autoclave option).
			</p>
			<p>
				<strong>This tool requires JavaScript.</strong>  This page makes moderate use of CSS standards and HTML5; please ensure that your browser observes these requirements.
			</p>
			<p>
				To begin, please select a scheme from the menu.
			</p>
		</section>
		{% include "ciphers/pane_affine.html" %}
		{% include "ciphers/pane_atbash.html" %}
		{% include "ciphers/pane_beaufort.html" %}
		{% include "ciphers/pane_caesar.html" %}
		{% include "ciphers/pane_codeword.html" %}
		{% include "ciphers/pane_vigenere.html" %}
	</form>
</article>
{% endblock %}

{% comment %}
<div id="descriptionforgronsfeld">The Gronsfeld cipher functions very similarly to the Vigen&#232;re (and related) ciphers.  The ciphertext alphabet, however, comprises numbers (0-9), rather than letters.  Although fewer alphabets are available for encoding (10 instead of 26), the ease of creating a lengthy numeric key may make up for this.  As a note, other sites may implement this mechanism somewhat differently.</div>
<div id="descriptionforvariant">The variant Beaufort cipher is functionally identical to the Vigen&#232;re cipher, except that the encryption and decryption steps are reversed.</div>
<div id="descriptionforvigenereautokey">For ciphers involving the tabula recta, the autoclave (or autokey) variant descriptor indicates in most cases that the plaintext will be appended to the key <em>during encoding</em>.  Essentially, a four-letter passphrase would effectively match, in length, its associated message.  This takes significantly more effort to decode than, say, a four-letter passphrase on non-autoclave versions of a cipher, where the passphrase will simply repeat.  Irrespective of whether one uses an autoclave cipher, perhaps the most secure method of encrypting a tabule recta message is to use a long string of gibberish (in letters) as the passphrase and mark it down for use as a one-time pad.  This transcends, ultimately, the differences between the autoclave and non-autoclave forms.</div>
{% endcomment %}
